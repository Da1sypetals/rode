# RoDe SPMM 测试使用说明

## 编译

使用Python编译脚本（需要nvcc）：

```bash
python compile.py
```

## 运行测试

```bash
python test.py
```

## 测试内容

测试脚本会验证以下参数限制：

### m 参数（稀疏矩阵行数）
- **限制**: 无限制 ✓
- **测试范围**: 1到65536（包括素数）
- **典型值**: 64, 128, 256, 512, 1024, 4096, 16384, 65536

### k 参数（稀疏矩阵列数 / 稠密矩阵行数）
- **限制**: 无限制 ✓
- **测试范围**: 1到10240（包括素数）
- **典型值**: 64, 128, 256, 512, 1024

### n 参数（稠密矩阵列数 / 输出维度）
- **限制**: 必须是 64 的倍数 ⚠
- **条件**: n % 64 == 0
- **有效值**: 64, 128, 192, 256, 320, 384, 448, 512, ...
- **无效值**: 1-63, 65-127, 129-191, 193-255, ...

### k_version 参数（内部优化参数）
- **说明**: 自动选择，无需手动指定
  - k <= 32: 使用 k_version=32
  - k > 32: 使用 k_version=128
- **影响**: 仅影响性能，不影响正确性

## GNN 应用建议

对于图神经网络中的消息聚合（C = A × B）：

```
A: m × k (邻接矩阵，稀疏)
B: k × n (特征矩阵，稠密)
C: m × n (输出矩阵)
```

**推荐配置**:
- m = k = node_count（节点数，任意正整数）
- n = feature_dim（特征维度，必须是64的倍数）

**常见配置示例**:
- 小型图: m=k=64, n=64
- 中型图: m=k=512, n=64 或 n=128
- 大型图: m=k=4096, n=128 或 n=256
- 超大型图: m=k=16384, n=256 或 n=512

如果你的特征维度不是64的倍数（例如n=100），需要：
1. 填充到128（最简单）
2. 或者修改模型设计使特征维度对齐

## 测试用例

测试脚本包含5个测试部分：

1. **边界测试**: 测试最小值和素数（验证m、k无限制）
2. **GNN典型用例测试**: 测试各种规模的GNN配置
3. **n的64倍数测试**: 测试n为64的1-64倍
4. **k_version自动选择测试**: 测试不同k值对应的k_version
5. **大规模测试**: 测试m和k达到10000-65536的场景

## 注意事项

- 测试需要CUDA兼容的GPU
- 编译需要nvcc（CUDA编译器）
- 大规模测试可能需要较长时间
- 每个测试有30秒超时限制
